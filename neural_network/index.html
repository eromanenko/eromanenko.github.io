<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>НС</title>

    <!-- <script src="http://unpkg.com/brain.js"></script> -->
    <script src="//unpkg.com/brain.js"></script>

	<style>
		body {
			background-color: #333;
		}

		.canvas {
			position: absolute;
			width: 500px;
			top: 50%;
			left: 50%;
			margin: auto;
			transform: translate(-50%, -50%);
			text-align: center;
		}
		#canv {
			background-color: white;
		}
	</style>
</head>
<body>
    <div>
		<p>
			<a href="https://www.youtube.com/embed/zTQwRe6_hCs" target="_blank" style="color: rgb(189, 189, 216);">youtube</a>
		</p>
		<p>
			<a href="https://github.com/BrainJS/brain.js" target="_blank" style="color: rgb(189, 189, 216);">brain.js on github</a>
		</p>
	</div>

	<div class="canvas">
		<canvas id="canv" style="display: block;">Ваш браузер устарел, обновитесь.</canvas>

		<div class="buttons">
			<button type="button" onclick="training()">Train (t)</button>
			<button type="button" onclick="braining()">Brain (b)</button>
			<button type="button" onclick="clearing()">Clear (Esc)</button>
		</div>
	</div>

	<script src="./canvas_drawing.js"></script>
	<script>
		const d = new DCanvas(document.getElementById('canv'));
		const train_data = [];

		const pushData = (param) => {
			const vector = d.calculate(true);
			train_data.push({
				input: vector,
				output: {[param]: 1}
			});
			d.clear();
		}

		const recognize = (data) => {
			const net = new brain.NeuralNetwork();
			net.train(data, {log: true});

			return brain.likely(d.calculate(), net);
		}

		document.addEventListener('keypress', function(e) {
			switch (e.key.toLowerCase()) {
				case 't':
					pushData( confirm('Positive?') ? 'positive' : 'negative');
					break;

				case 'b':
					braining()
					break;
				
				default: 
					pushData(e.key.toLowerCase());
					break;
			}

		});

		document.addEventListener('keydown', function(e) {
			switch (e.key) {
				case 'Escape':
				clearing();
					break;

				default: 
					break;
			}

		});

		//public actions
		const training = () => {
			pushData( confirm('Positive?') ? 'positive' : 'negative');
		};

		const braining = () => {
			const result = recognize(train_data);
			alert(result);
		};

		const clearing = () => {
			d.clear();
		}

	</script>

</body>
</html>